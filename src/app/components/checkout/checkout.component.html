<app-header></app-header>

<div class="checkout-page">
    <div class="container">
        <h1 class="page-title">Thanh toán</h1>

        <div class="checkout-layout">
            <!-- Form thông tin -->
            <div class="checkout-form">
                <form #checkoutForm="ngForm">
                    <div class="form-section">
                        <h2>Thông tin giao hàng</h2>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Họ và tên <span>*</span></label>
                                <input type="text" name="fullName" [(ngModel)]="fullName" (blur)="validateFullName()"
                                    placeholder="Nhập họ tên" [class.error]="fullNameError">
                                <span class="err" *ngIf="fullNameError">{{ fullNameError }}</span>
                            </div>
                            <div class="form-group">
                                <label>Số điện thoại <span>*</span></label>
                                <input type="tel" name="phoneNumber" [(ngModel)]="phoneNumber" (blur)="validatePhone()"
                                    placeholder="0912345678" [class.error]="phoneError">
                                <span class="err" *ngIf="phoneError">{{ phoneError }}</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Địa chỉ giao hàng <span>*</span></label>
                            <input type="text" name="address" [(ngModel)]="address" (blur)="validateAddress()"
                                placeholder="Số nhà, đường, phường, quận, tỉnh/TP" [class.error]="addressError">
                            <span class="err" *ngIf="addressError">{{ addressError }}</span>
                        </div>

                        <div class="form-group">
                            <label>Ghi chú</label>
                            <textarea name="note" [(ngModel)]="note" rows="2"
                                placeholder="Ghi chú cho shipper..."></textarea>
                        </div>
                    </div>

                    <!-- Shipping & Payment -->
                    <div class="form-section compact">
                        <div class="option-row">
                            <div class="option-group">
                                <h3>Vận chuyển</h3>
                                <label class="radio-opt" [class.active]="shippingMethod === 'express'">
                                    <input type="radio" name="shippingMethod" [(ngModel)]="shippingMethod"
                                        value="express">
                                    <span>Nhanh (1-2 ngày)</span>
                                </label>
                                <label class="radio-opt" [class.active]="shippingMethod === 'normal'">
                                    <input type="radio" name="shippingMethod" [(ngModel)]="shippingMethod"
                                        value="normal">
                                    <span>Tiêu chuẩn (3-5 ngày)</span>
                                </label>
                            </div>
                            <div class="option-group">
                                <h3>Thanh toán</h3>
                                <label class="radio-opt" [class.active]="paymentMethod === 'cod'">
                                    <input type="radio" name="paymentMethod" [(ngModel)]="paymentMethod" value="cod">
                                    <span><i class="fas fa-money-bill-wave"></i> COD</span>
                                </label>
                                <label class="radio-opt" [class.active]="paymentMethod === 'vnpay'">
                                    <input type="radio" name="paymentMethod" [(ngModel)]="paymentMethod" value="vnpay">
                                    <span><i class="fas fa-credit-card"></i> VNPAY</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <h2>Đơn hàng ({{ checkoutItems.length }})</h2>

                <div class="order-items">
                    @for(item of checkoutItems; track item.product.id) {
                    <div class="order-item">
                        <img [src]="item.product.thumbnail" [alt]="item.product.name">
                        <div class="item-info">
                            <span class="name">{{ item.product.name }}</span>
                            <span class="qty">x{{ item.quantity }}</span>
                        </div>
                        <span class="price">{{ (item.product.price * item.quantity) |
                            currency:'VND':'symbol':'1.0-0':'vi' }}</span>
                    </div>
                    }
                </div>

                <!-- Coupon -->
                <div class="coupon-row">
                    <input type="text" [(ngModel)]="couponCode" placeholder="Mã giảm giá" [disabled]="couponApplied">
                    <button type="button" (click)="applyCoupon()" [disabled]="couponApplied || !couponCode">
                        {{ couponApplied ? '✓' : 'Áp dụng' }}
                    </button>
                </div>

                <div class="summary-rows">
                    <div class="row"><span>Tạm tính</span><span>{{ totalAmount | currency:'VND':'symbol':'1.0-0':'vi'
                            }}</span></div>
                    <div class="row" *ngIf="discountAmount > 0"><span>Giảm giá</span><span class="discount">-{{
                            discountAmount | currency:'VND':'symbol':'1.0-0':'vi' }}</span></div>
                    <div class="row"><span>Phí vận chuyển</span><span class="free">Miễn phí</span></div>
                </div>

                <div class="total-row">
                    <span>Tổng cộng</span>
                    <span>{{ finalAmount | currency:'VND':'symbol':'1.0-0':'vi' }}</span>
                </div>

                <button type="button" class="btn-order" (click)="placeOrder()"
                    [disabled]="isSubmitting || !isFormValid()">
                    <span class="spinner" *ngIf="isSubmitting"></span>
                    {{ isSubmitting ? 'Đang xử lý...' : 'Đặt hàng' }}
                </button>

                <button type="button" class="btn-back" (click)="goBack()">← Quay lại giỏ hàng</button>
            </div>
        </div>
    </div>
</div>

<app-footer></app-footer>