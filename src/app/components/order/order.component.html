<app-header></app-header>

<div class="cart-page">
  <div class="container">
    <h1 class="page-title">Giỏ hàng của bạn</h1>

    @if(cartItems.length === 0) {
    <div class="empty-cart">
      <i class="fas fa-shopping-bag"></i>
      <p>Giỏ hàng của bạn đang trống</p>
      <a routerLink="/home" class="btn-continue">Tiếp tục mua sắm</a>
    </div>
    } @else {

    <div class="cart-layout">
      <!-- Danh sách sản phẩm -->
      <div class="cart-items-section">
        <!-- Header -->
        <div class="cart-header">
          <label class="select-all">
            <input type="checkbox" [checked]="isAllSelected" (change)="toggleSelectAll()">
            <span>Chọn tất cả ({{ cartItems.length }})</span>
          </label>
        </div>

        <!-- Cart Items -->
        <div class="cart-items-list">
          @for(item of cartItems; track (item.productDetailId ?? item.product.id); let i = $index) {
          <div class="cart-item">
            <!-- Checkbox -->
            <input type="checkbox" class="item-checkbox" [checked]="item.selected" (change)="toggleItemSelection(i)">

            <!-- Product Image -->
            <img [src]="item.product.thumbnail" [alt]="item.product.name" class="item-image"
              (error)="$any($event.target).src = 'assets/images/product-placeholder.png'">

            <!-- Product Info -->
            <div class="item-info">
              <a [routerLink]="['/products', item.product.id]" class="item-name">{{ item.product.name }}</a>
              <!-- Thuộc tính đã chọn -->
              <div class="item-attrs">
                @if(item.variant?.sizeName) {
                <span class="attr-tag">{{ item.variant?.sizeName }}</span>
                }
                @if(item.variant?.colorName) {
                <span class="attr-tag">{{ item.variant?.colorName }}</span>
                }
                @if(item.variant?.originName) {
                <span class="attr-tag">{{ item.variant?.originName }}</span>
                }
              </div>

            </div>

            <!-- Giá + Số lượng + Tổng (cùng hàng) -->
            <div class="item-price">{{ item.product.price | currency:'VND':'symbol':'1.0-0':'vi' }}</div>

            <div class="item-quantity">
              <button (click)="decreaseQuantity(i)" [disabled]="item.quantity <= 1">−</button>
              <span>{{ item.quantity }}</span>
              <button (click)="increaseQuantity(i)">+</button>
            </div>

            <div class="item-total">{{ (item.product.price * item.quantity) | currency:'VND':'symbol':'1.0-0':'vi' }}
            </div>

            <!-- Delete -->
            <button class="item-delete" (click)="removeItem(i)">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
          }
        </div>
      </div>

      <!-- Order Summary -->
      <div class="cart-summary">
        <h3>Thông tin đơn hàng</h3>
        <div class="summary-row">
          <span>Đã chọn</span>
          <span>{{ selectedCount }} sản phẩm</span>
        </div>
        <div class="summary-row">
          <span>Tạm tính</span>
          <span>{{ totalAmount | currency:'VND':'symbol':'1.0-0':'vi' }}</span>
        </div>
        <div class="summary-row">
          <span>Vận chuyển</span>
          <span class="free">Miễn phí</span>
        </div>
        <div class="summary-total">
          <span>Tổng</span>
          <span>{{ totalAmount | currency:'VND':'symbol':'1.0-0':'vi' }}</span>
        </div>
        <button class="btn-checkout" (click)="proceedToCheckout()" [disabled]="selectedCount === 0">
          Thanh toán
        </button>
        <a routerLink="/home" class="btn-back">← Tiếp tục mua sắm</a>
      </div>
    </div>
    }
  </div>
</div>

<app-footer></app-footer>