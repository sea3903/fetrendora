<app-header></app-header>

<div class="cart-page">
  <div class="container">
    <h1 class="page-title">Giỏ hàng</h1>

    @if(cartItems.length === 0) {
    <div class="empty-cart">
      <i class="fas fa-shopping-bag"></i>
      <p>Giỏ hàng của bạn đang trống</p>
      <a routerLink="/home" class="btn-continue">Tiếp tục mua sắm</a>
    </div>
    } @else {

    <div class="cart-content">
      <!-- Bảng sản phẩm -->
      <div class="cart-table">
        <!-- Header -->
        <div class="cart-header">
          <div class="col-checkbox">
            <input type="checkbox" [checked]="isAllSelected" (change)="toggleSelectAll()" id="selectAll">
            <label for="selectAll">Tất cả</label>
          </div>
          <div class="col-product">Sản phẩm</div>
          <div class="col-price">Đơn giá</div>
          <div class="col-quantity">Số lượng</div>
          <div class="col-total">Thành tiền</div>
          <div class="col-action"></div>
        </div>

        <!-- Cart Items -->
        @for(item of cartItems; track item.product.id; let i = $index) {
        <div class="cart-item">
          <!-- Checkbox -->
          <div class="col-checkbox">
            <input type="checkbox" [checked]="item.selected" (change)="toggleItemSelection(item.product.id)"
              [id]="'item-' + item.product.id">
          </div>

          <!-- Product Info -->
          <div class="col-product">
            <img [src]="item.product.thumbnail" [alt]="item.product.name" class="product-image"
              (error)="$any($event.target).src = 'assets/images/product-placeholder.png'">
            <div class="product-details">
              <a [routerLink]="['/products', item.product.id]" class="product-name">{{ item.product.name }}</a>
              @if(item.product.sku) {
              <span class="product-sku">Mã: {{ item.product.sku }}</span>
              }
            </div>
          </div>

          <!-- Unit Price -->
          <div class="col-price">
            {{ item.product.price | currency:'VND':'symbol':'1.0-0':'vi' }}
          </div>

          <!-- Quantity -->
          <div class="col-quantity">
            <div class="quantity-control">
              <button class="qty-btn" (click)="decreaseQuantity(i)" [disabled]="item.quantity <= 1">−</button>
              <span class="qty-value">{{ item.quantity }}</span>
              <button class="qty-btn" (click)="increaseQuantity(i)">+</button>
            </div>
          </div>

          <!-- Total -->
          <div class="col-total">
            {{ (item.product.price * item.quantity) | currency:'VND':'symbol':'1.0-0':'vi' }}
          </div>

          <!-- Delete -->
          <div class="col-action">
            <button class="btn-delete" (click)="removeItem(item.product.id)" title="Xóa">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>
        }
      </div>

      <!-- Cart Summary -->
      <div class="cart-summary">
        <div class="summary-row">
          <span>Đã chọn {{ selectedCount }} sản phẩm</span>
        </div>
        <div class="summary-row total">
          <span>Tổng tiền:</span>
          <span class="total-amount">{{ totalAmount | currency:'VND':'symbol':'1.0-0':'vi' }}</span>
        </div>
        <button class="btn-checkout" (click)="proceedToCheckout()" [disabled]="selectedCount === 0">
          Tiến hành thanh toán
        </button>
        <a routerLink="/home" class="btn-continue-shopping">
          <i class="fas fa-arrow-left"></i>
          Tiếp tục mua sắm
        </a>
      </div>
    </div>
    }
  </div>
</div>

<app-footer></app-footer>